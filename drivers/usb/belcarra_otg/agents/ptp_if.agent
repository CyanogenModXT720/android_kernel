#!/bin/sh
###################################################################
#
# Filename:     ptp_if.agent
# Description:
#      PTP hotplug policy agent
#
#      Kernel hotplug params include:
#	
#	ACTION=%s [attach or detach]
#	INTERFACE=%s
#
#
# The ptp_if.agent script is called by the pbg_if function
# when the USB Device is attached or detached from a USB Host.
#
# Copyright:
#
#     
#      Advanced Technology and Software Operations
#      Copyright (c) Motorola 2007
#
# HISTORY:
#
#        Author              Date             Description
#       ----------          --------         ------------- 
#       Motorola            02/26/07        Initial
#       Motorola            10/04/07        Changes for OSS compliance
#
#####################################################################

MODULE=mtp
DEVICE=mtp

cd /etc/hotplug
. ./hotplug.functions

# remove stale nodes
rm -f /dev/${DEVICE}

case $ACTION in
attach)
	echo "PTP Attach received"
	MAJOR=`grep $MODULE /proc/devices | sed -e "s/ $MODULE//"`
	mknod /dev/${DEVICE} c $MAJOR 0
	. /etc/initservices/services/ezxenv.sh
	/usr/local/bin/mtpcontrol -t > /tmp/mtpcontrol.log
	;;

detach)
	echo "PTP Detach received"
	. /etc/initservices/services/ezxenv.sh
	/usr/local/bin/mtpcontrol -t -d >> /tmp/mtpcontrol.log
	;;

*) 
	echo "No ACTION received"
	;;
esac 

exit 0

